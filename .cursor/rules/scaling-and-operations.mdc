---
description: Follow industry practices for scaling, reliability, security, and operations. Applies when changing infra, APIs, rate limits, sessions, external calls, or observability.
globs: 
  - api/**/*.ts
  - database/**/*.sql
  - docs/**/*.md
alwaysApply: false
---

# Scaling and operations â€” industry practices

When working on **scaling**, **reliability**, **deployment**, **security**, or **operations**:

1. **Use the roadmap as the source of truth**  
   Follow `docs/SCALING-ROADMAP.md`. It is written from an **industry practices** perspective (12-Factor App, SRE, Well-Architected, resilience patterns).

2. **Align with these practices**
   - **Stateless API**, config and secrets from env/vault (12-Factor).
   - **Resilience:** circuit breaker, retries with exponential backoff, timeouts, graceful degradation for external calls (OpenAI, DB, Redis, Pinecone).
   - **Rate limiting by identity** when the user is authenticated (not only by IP).
   - **Bounded data:** cap conversation history; use SCAN (not KEYS) in Redis for pattern operations.
   - **Observability:** metrics, tracing, structured logs; avoid PII in logs; sampling at high QPS.
   - **Security:** least privilege, no PII in logs by default, retention and data minimization.

3. **When adding or changing**
   - External calls: add timeouts, retries, and circuit breaker if missing.
   - Rate limiters: prefer per-user (e.g. Redis-backed) when auth context exists.
   - Session/DB: ensure indexes and cleanup are in place; keep storage bounded.
   - Logging: do not log full user context, emails, or names; use field names/lengths or sampling.

4. **References** (for deeper decisions)  
   The roadmap links to 12-Factor, Google SRE, AWS Well-Architected, and OWASP. Prefer options that match these over one-off fixes.
